-- Tabela de Clientes
CREATE TABLE Clientes (
    cliente_id INTEGER PRIMARY KEY AUTOINCREMENT,
    nome TEXT NOT NULL,
    telefone TEXT,
    email TEXT,
    endereco TEXT
);

-- Tabela de Técnicos
CREATE TABLE Tecnicos (
    tecnico_id INTEGER PRIMARY KEY AUTOINCREMENT,
    nome TEXT NOT NULL,
    especialidade TEXT
);

-- Tabela de Status de Atendimento
CREATE TABLE StatusAtendimento (
    status_id INTEGER PRIMARY KEY AUTOINCREMENT,
    descricao TEXT NOT NULL
);

-- Tabela de Ordens de Serviço
CREATE TABLE OrdensServico (
    ordem_id INTEGER PRIMARY KEY AUTOINCREMENT,
    cliente_id INTEGER NOT NULL,
    tecnico_id INTEGER,
    status_id INTEGER NOT NULL,
    descricao_problema TEXT NOT NULL,
    data_abertura TEXT NOT NULL,
    data_fechamento TEXT,
    FOREIGN KEY (cliente_id) REFERENCES Clientes(cliente_id),
    FOREIGN KEY (tecnico_id) REFERENCES Tecnicos(tecnico_id),
    FOREIGN KEY (status_id) REFERENCES StatusAtendimento(status_id)
);

-- Tabela de Histórico de Atendimento
CREATE TABLE HistoricoAtendimento (
    historico_id INTEGER PRIMARY KEY AUTOINCREMENT,
    ordem_id INTEGER NOT NULL,
    data_atualizacao TEXT NOT NULL,
    observacoes TEXT,
    status_id INTEGER NOT NULL,
    FOREIGN KEY (ordem_id) REFERENCES OrdensServico(ordem_id),
    FOREIGN KEY (status_id) REFERENCES StatusAtendimento(status_id)
);

-- Inserindo alguns status de atendimento
INSERT INTO StatusAtendimento (descricao) VALUES ('Aberta');
INSERT INTO StatusAtendimento (descricao) VALUES ('Em andamento');
INSERT INTO StatusAtendimento (descricao) VALUES ('Concluída');

-- Inserindo clientes
INSERT INTO Clientes (nome, telefone, email, endereco) 
VALUES ('João Silva', '9999-9999', 'joao@exemplo.com', 'Rua A, 123');

-- Inserindo técnicos
INSERT INTO Tecnicos (nome, especialidade) 
VALUES ('Maria Souza', 'Montagem de Móveis');

-- Criando uma ordem de serviço
INSERT INTO OrdensServico (cliente_id, tecnico_id, status_id, descricao_problema, data_abertura) 
VALUES (1, 1, 1, 'Problema na montagem de um armário', date('now'));

-- Atualizando status no histórico de atendimento
INSERT INTO HistoricoAtendimento (ordem_id, data_atualizacao, observacoes, status_id) 
VALUES (1, date('now'), 'Técnico designado para o atendimento', 2);
